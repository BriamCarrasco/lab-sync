<app-toast [message]="toastMsg" [show]="showToast" [type]="toastType"></app-toast>
<section class="vh-100">
  <div class="container-fluid h-100 d-flex justify-content-center align-items-center">
    <div class="col-md-6 col-lg-4">
      <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        <h4 class="mb-4 text-center">Cambiar contraseña</h4>

        <div class="form-outline mb-3">
          <label class="form-label" for="currentPassword">Contraseña actual</label>
          <input
            type="password"
            id="currentPassword"
            class="form-control"
            formControlName="currentPassword"
            [class.is-invalid]="currentPassword.invalid && (currentPassword.touched || isSubmitted)"
            placeholder="Ingrese su contraseña actual"
            autocomplete="current-password"
          />
          <div *ngIf="currentPassword.errors?.['required'] && (currentPassword.touched || isSubmitted)" class="invalid-feedback d-block">
            La contraseña actual es obligatoria.
          </div>
        </div>

        <div class="form-outline mb-3">
          <label class="form-label" for="newPassword">Nueva contraseña</label>
          <input
            type="password"
            id="newPassword"
            class="form-control"
            formControlName="newPassword"
            [class.is-invalid]="newPassword.invalid && (newPassword.touched || isSubmitted)"
            placeholder="Ingrese la nueva contraseña"
            autocomplete="new-password"
          />
          <div *ngIf="newPassword.errors?.['required'] && (newPassword.touched || isSubmitted)" class="invalid-feedback d-block">
            La nueva contraseña es obligatoria.
          </div>
          <div *ngIf="newPassword.invalid && (newPassword.touched || isSubmitted)" class="invalid-feedback d-block">
            La contraseña debe tener al menos 8 caracteres, contener una mayúscula, una minúscula, un número y un símbolo especial.
          </div>
          <ul class="password-rules mt-2 mb-0">
            <li [class.text-danger]="!newPasswordHasMinLength">Mínimo 8 caracteres</li>
            <li [class.text-danger]="!newPasswordHasNumber">Al menos un número</li>
            <li [class.text-danger]="!newPasswordHasUpper">Al menos una mayúscula</li>
            <li [class.text-danger]="!newPasswordHasLower">Al menos una minúscula</li>
            <li [class.text-danger]="!newPasswordHasSpecial">Al menos un símbolo especial</li>
          </ul>
        </div>

        <div class="form-outline mb-3">
          <label class="form-label" for="repeatPassword">Repetir nueva contraseña</label>
          <input
            type="password"
            id="repeatPassword"
            class="form-control"
            formControlName="repeatPassword"
            [class.is-invalid]="(repeatPassword.invalid && (repeatPassword.touched || isSubmitted)) || (passwordForm.errors?.['mismatch'] && isSubmitted)"
            placeholder="Repita la nueva contraseña"
            autocomplete="new-password"
          />
          <div *ngIf="repeatPassword.errors?.['required'] && (repeatPassword.touched || isSubmitted)" class="invalid-feedback d-block">
            Debe repetir la nueva contraseña.
          </div>
          <div *ngIf="passwordForm.errors?.['mismatch'] && isSubmitted" class="invalid-feedback d-block">
            Las contraseñas nuevas no coinciden.
          </div>
        </div>

        <div class="text-center mt-4">
          <button type="submit" class="btn btn-main text-white w-100" [disabled]="loading">
            {{ loading ? 'Guardando...' : 'Guardar cambios' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</section>